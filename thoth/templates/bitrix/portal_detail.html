{% extends "base.html" %}
{% load i18n %}

{% block title %}
  {% trans "Portal Details" %} - {{ portal.domain }}
{% endblock title %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <div class="card">
        <div class="card-header">
          <h4>{% trans "Portal" %}: {{ portal.domain }}</h4>
        </div>
        <div class="card-body">
          <form method="post">
            {% csrf_token %}
            <div class="mb-3">
              <label class="form-label fw-bold">{% trans "Portal Owner" %}:</label>
              <p class="form-control-plaintext">
                {% if portal.owner %}
                  {{ portal.owner.email }}
                {% else %}
                  {% trans "Not assigned" %}
                {% endif %}
              </p>
            </div>
            
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" 
                       id="imopenlines_auto_finish" name="imopenlines_auto_finish"
                       {% if portal.imopenlines_auto_finish %}checked{% endif %}>
                <label class="form-check-label" for="imopenlines_auto_finish">
                  {% trans "Auto close openlines chats if deal (lead) is completed" %}
                </label>
              </div>
            </div>

          <div class="mb-3 d-flex align-items-center">
            <input type="number" class="form-control me-2" style="width: 90px; max-width: 120px;" 
                  name="finish_delay" value="{{ portal.finish_delay }}" maxlength="3" min="0">
            <span>{% trans "Finish Delay (minutes)" %}</span>
          </div>
            {% if open_lines %}
            <div class="mb-3">
              <label class="form-label fw-bold">{% trans "Open Lines" %}:</label>
              <table class="table table-bordered align-middle">
                <thead>
                  <tr>
                    <th>{% trans "Line ID" %}</th>
                    <th>{% trans "Connector" %}</th>
                    <th>{% trans "Name" %}</th>
                    <th>{% trans "Delete" %}</th>
                  </tr>
                </thead>
                <tbody>
                  {% for line in open_lines %}
                  <tr>
                    <td>{{ line.line_id }}</td>
                    <td>{{ line.connector }}</td>
                    <td>
                      <input type="text" class="form-control" name="line_name_{{ line.id }}" value="{{ line.name }}">
                    </td>
                    <td class="text-center">
                      <input type="checkbox" name="delete_line_{{ line.id }}">
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% endif %}

            <div class="d-flex justify-content-between">
              <a href="{% url 'portals' %}" class="btn btn-secondary">
                {% trans "Back to Portals" %}
              </a>
              <button type="submit" class="btn btn-primary connect-btn">
                {% trans "Save" %}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
